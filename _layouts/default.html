<!DOCTYPE html>
<html lang="{{ site.lang | default: 'fr' }}">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <link
      rel="icon"
      type="image/png"
      href="/assets/img/favicon-96x96.png"
      sizes="96x96"
    />
    <link rel="icon" type="image/svg+xml" href="/assets/img/favicon.svg" />
    <link rel="shortcut icon" href="/assets/img/favicon.ico" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/assets/img/apple-touch-icon.png"
    />
    <link rel="manifest" href="/assets/img/site.webmanifest" />
    <link
      rel="stylesheet"
      href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}"
      media="screen"
      type="text/css"
    />

    <title>{{ page.title | default: site.title }}</title>

    <!-- Language Detection & Redirect Script -->
    <script>
      (function () {
        const SUPPORTED_LANGS = ["fr", "en"];
        const DEFAULT_LANG = "fr";
        const STORAGE_KEY = "preferredLanguage";

        const storedLang = localStorage.getItem(STORAGE_KEY);

        const currentPath = window.location.pathname;
        const currentLang = currentPath.startsWith("/en") ? "en" : "fr";

        if (storedLang && storedLang !== currentLang) {
          const cleanPath = currentPath.replace(/^\/en/, "") || "/";
          const newPath = storedLang === "en" ? "/en" + cleanPath : cleanPath;

          window.location.replace(newPath);
        } else if (!storedLang) {
          const browserLang = (navigator.language || navigator.userLanguage)
            .split("-")[0]
            .toLowerCase();

          const targetLang = SUPPORTED_LANGS.includes(browserLang)
            ? browserLang
            : DEFAULT_LANG;

          localStorage.setItem(STORAGE_KEY, targetLang);

          if (targetLang !== currentLang) {
            const cleanPath = currentPath.replace(/^\/en/, "") || "/";
            const newPath = targetLang === "en" ? "/en" + cleanPath : cleanPath;
            window.location.replace(newPath);
          }
        } else {
          localStorage.setItem(STORAGE_KEY, currentLang);
        }
      })();

      document.addEventListener("DOMContentLoaded", function () {
        const STORAGE_KEY = "preferredLanguage";
        const currentPath = window.location.pathname;
        const currentLang = currentPath.startsWith("/en") ? "en" : "fr";

        window.switchLanguage = function (lang) {
          if (lang === currentLang) {
            return;
          }

          localStorage.setItem(STORAGE_KEY, lang);

          const cleanPath = currentPath.replace(/^\/en/, "") || "/";
          const newPath = lang === "en" ? "/en" + cleanPath : cleanPath;

          window.location.replace(newPath);
        };

        const updateActiveButton = () => {
          const frBtn = document.getElementById("lang-fr");
          const enBtn = document.getElementById("lang-en");

          if (frBtn && enBtn) {
            if (currentLang === "fr") {
              frBtn.classList.add("active");
              enBtn.classList.remove("active");
            } else {
              enBtn.classList.add("active");
              frBtn.classList.remove("active");
            }
          }
        };

        updateActiveButton();
      });
    </script>
  </head>

  <body>
    <!-- Language Switcher -->
    <div class="language-switcher">
      <button
        id="lang-fr"
        class="lang-btn"
        onclick="switchLanguage('fr')"
        aria-label="Français"
      >
        FR
      </button>
      <button
        id="lang-en"
        class="lang-btn"
        onclick="switchLanguage('en')"
        aria-label="English"
      >
        EN
      </button>
    </div>

    <!-- <header>
      <div class="inner">
        <h1>{{ site.title }}</h1>
        <h2>{{ site.description }}</h2>
      </div>
    </header> -->

    <div>
      <section id="main-content">{{ content }}</section>
    </div>

    <!-- <footer>
      <div class="inner">
        <p>© 2025 Benoît Rongeard - Tous droits réservés</p>
      </div>
    </footer> -->
  </body>
</html>
